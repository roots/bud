"use strict";(self.webpackChunk_roots_bud_docs=self.webpackChunk_roots_bud_docs||[]).push([[66501],{3905:function(e,n,t){t.d(n,{Zo:function(){return d},kt:function(){return m}});var i=t(67294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,i)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,i,a=function(e,n){if(null==e)return{};var t,i,a={},r=Object.keys(e);for(i=0;i<r.length;i++)t=r[i],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(i=0;i<r.length;i++)t=r[i],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var l=i.createContext({}),u=function(e){var n=i.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},d=function(e){var n=u(e.components);return i.createElement(l.Provider,{value:n},e.children)},p={inlineCode:"code",wrapper:function(e){var n=e.children;return i.createElement(i.Fragment,{},n)}},c=i.forwardRef((function(e,n){var t=e.components,a=e.mdxType,r=e.originalType,l=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),c=u(t),m=a,g=c["".concat(l,".").concat(m)]||c[m]||p[m]||r;return t?i.createElement(g,o(o({ref:n},d),{},{components:t})):i.createElement(g,o({ref:n},d))}));function m(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var r=t.length,o=new Array(r);o[0]=c;var s={};for(var l in n)hasOwnProperty.call(n,l)&&(s[l]=n[l]);s.originalType=e,s.mdxType="string"==typeof e?e:a,o[1]=s;for(var u=2;u<r;u++)o[u]=t[u];return i.createElement.apply(null,o)}return i.createElement.apply(null,t)}c.displayName="MDXCreateElement"},91043:function(e,n,t){t.r(n),t.d(n,{frontMatter:function(){return u},contentTitle:function(){return d},metadata:function(){return p},toc:function(){return c},default:function(){return g}});var i=t(87462),a=t(63366),r=(t(67294),t(3905)),o=t(26396),s=t(58215),l=["components"],u={title:"Optimizing compiled assets",sidebar_label:"Optimizing compiled assets",description:"Part 7/7 of the Getting Started guide covers optimizing your build assets for production",sidebar_position:8,image:"https://budjs.netlify.app/img/share/guides/getting-started__optimization.png"},d=void 0,p={unversionedId:"getting-started/optimizing",id:"getting-started/optimizing",title:"Optimizing compiled assets",description:"Part 7/7 of the Getting Started guide covers optimizing your build assets for production",source:"@site/guides/getting-started/optimizing.mdx",sourceDirName:"getting-started",slug:"/getting-started/optimizing",permalink:"/guides/getting-started/optimizing",tags:[],version:"current",sidebarPosition:8,frontMatter:{title:"Optimizing compiled assets",sidebar_label:"Optimizing compiled assets",description:"Part 7/7 of the Getting Started guide covers optimizing your build assets for production",sidebar_position:8,image:"https://budjs.netlify.app/img/share/guides/getting-started__optimization.png"},sidebar:"sidebar",previous:{title:"Copying static assets",permalink:"/guides/getting-started/assets"},next:{title:"Introduction",permalink:"/guides/general-use/"}},c=[{value:"Minimizing filesizes",id:"minimizing-filesizes",children:[],level:2},{value:"Hashing filenames",id:"hashing-filenames",children:[],level:2},{value:"Create a runtime",id:"create-a-runtime",children:[],level:2},{value:"Split out vendored code",id:"split-out-vendored-code",children:[],level:2},{value:"Optimizing images",id:"optimizing-images",children:[],level:2},{value:"Applying optimizations conditionally",id:"applying-optimizations-conditionally",children:[],level:2}],m={toc:c};function g(e){var n=e.components,t=(0,a.Z)(e,l);return(0,r.kt)("wrapper",(0,i.Z)({},m,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"We're now compilnig project assets with babel and postcss."),(0,r.kt)("h2",{id:"minimizing-filesizes"},"Minimizing filesizes"),(0,r.kt)("p",null,"Minify css and js output using ",(0,r.kt)("a",{parentName:"p",href:"/docs/bud.minimize"},"bud.minimize")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:"{13} title='bud.config.js'","{13}":!0,title:"'bud.config.js'"},"module.exports = async bud =>\n  bud\n    .entry({\n      main: ['index.js', 'index.css'],\n      landing: 'landing.js',\n    })\n    .assets(['images/**/*.{png,gif,jpg}'])\n    .template()\n    .minimize()\n")),(0,r.kt)("h2",{id:"hashing-filenames"},"Hashing filenames"),(0,r.kt)("p",null,"Add filename hashing using ",(0,r.kt)("a",{parentName:"p",href:"/docs/bud.hash"},"bud.hash")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:"{14} title='bud.config.js'","{14}":!0,title:"'bud.config.js'"},"module.exports = async bud =>\n  bud\n    .entry({\n      main: ['index.js', 'index.css'],\n      landing: 'landing.js',\n    })\n    .assets(['images/**/*.{png,gif,jpg}'])\n    .template()\n    .minimize()\n    .hash()\n")),(0,r.kt)("h2",{id:"create-a-runtime"},"Create a runtime"),(0,r.kt)("p",null,"We can leverage code splitting using ",(0,r.kt)("a",{parentName:"p",href:"/docs/bud.runtime"},"bud.runtime")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:"{15} title='bud.config.js'","{15}":!0,title:"'bud.config.js'"},"module.exports = async bud =>\n  bud\n    .entry({\n      main: ['index.js', 'index.css'],\n      landing: 'landing.js',\n    })\n    .assets(['images/**/*.{png,gif,jpg}'])\n    .template()\n    .minimize()\n    .hash()\n    .runtime()\n")),(0,r.kt)("h2",{id:"split-out-vendored-code"},"Split out vendored code"),(0,r.kt)("p",null,"We'll probably end up installing additional packages in our project. We can use ",(0,r.kt)("a",{parentName:"p",href:"/docs/bud.splitChunks"},"bud.splitChunks")," to ensure\nthey are always packaged separately from our application code"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:"{16} title='bud.config.js'","{16}":!0,title:"'bud.config.js'"},"module.exports = async bud =>\n  bud\n    .entry({\n      main: ['index.js', 'index.css'],\n      landing: 'landing.js',\n    })\n    .assets(['images/**/*.{png,gif,jpg}'])\n    .template()\n    .minimize()\n    .hash()\n    .runtime()\n    .splitChunks()\n")),(0,r.kt)("h2",{id:"optimizing-images"},"Optimizing images"),(0,r.kt)("p",null,"Image optimization can be added using the ",(0,r.kt)("a",{parentName:"p",href:"/extensions/bud-imagemin"},"@roots/bud-imagemin")," extension."),(0,r.kt)(o.Z,{groupId:"pacman",defaultValue:"yarn",values:[{label:"yarn",value:"yarn"},{label:"npm",value:"npm"}],mdxType:"Tabs"},(0,r.kt)(s.Z,{value:"yarn",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"yarn add @roots/bud-imagemin --dev\n"))),(0,r.kt)(s.Z,{value:"npm",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"npm install @roots/bud-imagemin --save-dev\n")))),(0,r.kt)("p",null,"Remember to run ",(0,r.kt)("strong",{parentName:"p"},"bud install")," after installing to ensure you have the proper peer dependencies. Then, add the extension to your config."),(0,r.kt)("p",null,"You can provide additional configuration to the ",(0,r.kt)("a",{parentName:"p",href:"/extensions/bud-imagemin"},"@roots/bud-imagemin")," extension using ",(0,r.kt)("inlineCode",{parentName:"p"},"bud.imagemin"),". but we won't get into that."),(0,r.kt)("h2",{id:"applying-optimizations-conditionally"},"Applying optimizations conditionally"),(0,r.kt)("p",null,"All of these optimizations are slowing down our dev builds for no reason. Worse still, the ",(0,r.kt)("a",{parentName:"p",href:"/docs/bud.hash"},"bud.hash")," function is breaking our hot reloading."),(0,r.kt)("p",null,"Let's use ",(0,r.kt)("a",{parentName:"p",href:"/docs/bud.mode/"},"bud.mode")," to only apply these optimizations for production builds."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:"{14-21} title='bud.config.js'","{14-21}":!0,title:"'bud.config.js'"},"module.exports = async bud => {\n  bud\n    .entry({\n      main: ['index.js', 'index.css'],\n      landing: 'landing.js',\n    })\n    .assets(['images/**/*.{png,gif,jpg}'])\n    .template()\n\n  if (bud.mode === 'production') {\n    bud.minimize().hash().runtime().splitChunks()\n  }\n}\n")),(0,r.kt)("p",null,"That's better. Hot reloading works again and our build has been restored to its former, snappy glory. But, sadly,\nwe broke our impressive looking function chain to get back to this point."),(0,r.kt)("p",null,"We can fix that using another helpful bud property: ",(0,r.kt)("a",{parentName:"p",href:"/docs/bud.mode/bud.isProduction"},"bud.isProduction"),". This property is a boolean and is ",(0,r.kt)("strong",{parentName:"p"},"true"),"\nwhen bud is being run in ",(0,r.kt)("inlineCode",{parentName:"p"},"production")," mode. This can help us replace that ",(0,r.kt)("inlineCode",{parentName:"p"},"if")," statement."),(0,r.kt)("p",null,"We'll pair ",(0,r.kt)("a",{parentName:"p",href:"/docs/bud.mode/bud.isProduction"},"bud.isProduction")," up with a utility function called ",(0,r.kt)("a",{parentName:"p",href:"/docs/bud.when"},"bud.when"),",\nwhich allows us to do things only when certain conditions are met."),(0,r.kt)("p",null,"Check the documentation for additional clarity on how they work (and work together!) but this is how we'll use them in our config to get everything cleaned up:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:"{13-20} title='bud.config.js'","{13-20}":!0,title:"'bud.config.js'"},"module.exports = async bud =>\n  bud\n    .entry({\n      main: ['index.js', 'index.css'],\n      landing: 'landing.js',\n    })\n    .assets(['images/**/*.{png,gif,jpg}'])\n    .template()\n    .when(bud.isProduction, bud =>\n      bud\n        .use(require('@roots/bud-imagemin'))\n        .minimize()\n        .hash()\n        .runtime()\n        .splitChunks(),\n    )\n")))}g.isMDXComponent=!0},58215:function(e,n,t){var i=t(67294);n.Z=function(e){var n=e.children,t=e.hidden,a=e.className;return i.createElement("div",{role:"tabpanel",hidden:t,className:a},n)}},26396:function(e,n,t){t.d(n,{Z:function(){return c}});var i=t(87462),a=t(67294),r=t(72389),o=t(79443);var s=function(){var e=(0,a.useContext)(o.Z);if(null==e)throw new Error('"useUserPreferencesContext" is used outside of "Layout" component.');return e},l=t(63616),u=t(86010),d="tabItem_1uMI";function p(e){var n,t,r,o=e.lazy,p=e.block,c=e.defaultValue,m=e.values,g=e.groupId,f=e.className,b=a.Children.map(e.children,(function(e){if((0,a.isValidElement)(e)&&void 0!==e.props.value)return e;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})),h=null!=m?m:b.map((function(e){var n=e.props;return{value:n.value,label:n.label,attributes:n.attributes}})),v=(0,l.lx)(h,(function(e,n){return e.value===n.value}));if(v.length>0)throw new Error('Docusaurus error: Duplicate values "'+v.map((function(e){return e.value})).join(", ")+'" found in <Tabs>. Every value needs to be unique.');var y=null===c?c:null!=(n=null!=c?c:null==(t=b.find((function(e){return e.props.default})))?void 0:t.props.value)?n:null==(r=b[0])?void 0:r.props.value;if(null!==y&&!h.some((function(e){return e.value===y})))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+y+'" but none of its children has the corresponding value. Available values are: '+h.map((function(e){return e.value})).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");var k=s(),j=k.tabGroupChoices,w=k.setTabGroupChoices,x=(0,a.useState)(y),z=x[0],N=x[1],O=[],T=(0,l.o5)().blockElementScrollPositionUntilNextRender;if(null!=g){var C=j[g];null!=C&&C!==z&&h.some((function(e){return e.value===C}))&&N(C)}var E=function(e){var n=e.currentTarget,t=O.indexOf(n),i=h[t].value;i!==z&&(T(n),N(i),null!=g&&w(g,i))},P=function(e){var n,t=null;switch(e.key){case"ArrowRight":var i=O.indexOf(e.currentTarget)+1;t=O[i]||O[0];break;case"ArrowLeft":var a=O.indexOf(e.currentTarget)-1;t=O[a]||O[O.length-1]}null==(n=t)||n.focus()};return a.createElement("div",{className:"tabs-container"},a.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,u.Z)("tabs",{"tabs--block":p},f)},h.map((function(e){var n=e.value,t=e.label,r=e.attributes;return a.createElement("li",(0,i.Z)({role:"tab",tabIndex:z===n?0:-1,"aria-selected":z===n,key:n,ref:function(e){return O.push(e)},onKeyDown:P,onFocus:E,onClick:E},r,{className:(0,u.Z)("tabs__item",d,null==r?void 0:r.className,{"tabs__item--active":z===n})}),null!=t?t:n)}))),o?(0,a.cloneElement)(b.filter((function(e){return e.props.value===z}))[0],{className:"margin-vert--md"}):a.createElement("div",{className:"margin-vert--md"},b.map((function(e,n){return(0,a.cloneElement)(e,{key:n,hidden:e.props.value!==z})}))))}function c(e){var n=(0,r.Z)();return a.createElement(p,(0,i.Z)({key:String(n)},e))}}}]);