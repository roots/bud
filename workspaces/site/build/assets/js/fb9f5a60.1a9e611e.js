"use strict";(self.webpackChunk_roots_bud_docs=self.webpackChunk_roots_bud_docs||[]).push([[41878],{22321:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return s},contentTitle:function(){return c},metadata:function(){return p},toc:function(){return m},default:function(){return h}});var a=n(87462),r=n(63366),i=(n(67294),n(3905)),l=n(26396),o=n(58215),u=(n(19055),["components"]),s={title:"Running multiple compilers",description:"It is possible to configure more than one Webpack compiler from a single bud config.",sidebar_label:"Multi-compiler"},c=void 0,p={unversionedId:"general-use/multi-compiler",id:"general-use/multi-compiler",title:"Running multiple compilers",description:"It is possible to configure more than one Webpack compiler from a single bud config.",source:"@site/guides/general-use/multi-compiler.mdx",sourceDirName:"general-use",slug:"/general-use/multi-compiler",permalink:"/guides/general-use/multi-compiler",tags:[],version:"current",frontMatter:{title:"Running multiple compilers",description:"It is possible to configure more than one Webpack compiler from a single bud config.",sidebar_label:"Multi-compiler"},sidebar:"sidebar",previous:{title:"Filename hashing",permalink:"/guides/general-use/hashing"},next:{title:"Architecture",permalink:"/guides/advanced-use/architecture"}},m=[{value:"In practice",id:"in-practice",children:[],level:2},{value:"Using the <code>--target</code> flag",id:"using-the---target-flag",children:[],level:2},{value:"Compilers can only be made from the parent context",id:"compilers-can-only-be-made-from-the-parent-context",children:[],level:2}],d={toc:m};function h(e){var t=e.components,n=(0,r.Z)(e,u);return(0,i.kt)("wrapper",(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"It is possible to configure more than one Webpack compiler from a single bud config file."),(0,i.kt)("p",null,"For a single page app this isn't really that useful. However, for WordPress or a Symfony app ","\u2014"," anything with very different\nneeds for its marketing pages and administrative interfaces ","\u2014"," it is potentially very useful."),(0,i.kt)("h2",{id:"in-practice"},"In practice"),(0,i.kt)("p",null,"To specify a new child instance, we can use ",(0,i.kt)("a",{parentName:"p",href:"/docs/bud.make"},"bud.make"),". It is a function that accepts two parameters: a name for the instance\n(so we can refer to it later), and a callback that is identical to the standard ",(0,i.kt)("inlineCode",{parentName:"p"},"bud.config.js")," module-level function."),(0,i.kt)("p",null,"In this example we're creating two instances of bud: one for ",(0,i.kt)("inlineCode",{parentName:"p"},"theme")," code and another for ",(0,i.kt)("inlineCode",{parentName:"p"},"plugin")," code."),(0,i.kt)(l.Z,{groupId:"lang",defaultValue:"ts",values:[{label:"Javascript",value:"js"},{label:"TypeScript",value:"ts"}],mdxType:"Tabs"},(0,i.kt)(o.Z,{value:"js",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js",metastring:"title='bud.config.js'",title:"'bud.config.js'"},"module.exports = app =>\n  app\n    .make('theme', theme =>\n      theme\n        .use(require('@roots/bud-babel'))\n        .setPath('dist', 'dist/theme')\n        .entry('theme', ['theme.js', 'theme.css']),\n    )\n    .make('plugin', plugin =>\n      plugin\n        .use([\n          require('@roots/bud-babel'),\n          require('@roots/bud-react'),\n        ])\n        .setPath('dist', 'dist/plugin')\n        .entry('plugin', ['plugin.js', 'plugin.css']),\n    )\n"))),(0,i.kt)(o.Z,{value:"ts",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-ts",metastring:"title='bud.config.ts'",title:"'bud.config.ts'"},"import type {Framework} from '@roots/bud'\nimport Babel from '@roots/bud-babel'\nimport React from '@roots/bud-react'\n\nexport default (app: Framework): void =>\n  app\n    .make('theme', (theme: Framework): void => {\n      theme\n        .use(Babel)\n        .setPath('dist', 'dist/theme')\n        .entry('theme', ['theme.js', 'theme.css'])\n    })\n    .make('plugin', (plugin: Framework): void =>\n      plugin\n        .use([Babel, React])\n        .setPath('dist', 'dist/plugin')\n        .entry('plugin', ['plugin.js', 'plugin.css']),\n    )\n")))),(0,i.kt)("p",null,"There is an implicit benefit to structuring our config this way: our ",(0,i.kt)("inlineCode",{parentName:"p"},"plugin")," compiler uses ",(0,i.kt)("a",{parentName:"p",href:"/extensions/bud-react"},"@roots/bud-react"),",\nbut our ",(0,i.kt)("inlineCode",{parentName:"p"},"theme")," compiler does not."),(0,i.kt)("p",null,"Ideally, tree-shaking would make it so that react code didn't make it into our theme but now that we've separated our\nbuild into two distinct compilations we've all but guaranteed that it won't."),(0,i.kt)("h2",{id:"using-the---target-flag"},"Using the ",(0,i.kt)("inlineCode",{parentName:"h2"},"--target")," flag"),(0,i.kt)("p",null,"The other benefit is a potentially massive workflow improvement. Let's say that we have to work on the ",(0,i.kt)("inlineCode",{parentName:"p"},"theme")," more often than the ",(0,i.kt)("inlineCode",{parentName:"p"},"plugin"),".\nWith the above config we don't have to rebuild the ",(0,i.kt)("inlineCode",{parentName:"p"},"plugin")," code again just to work on our ",(0,i.kt)("inlineCode",{parentName:"p"},"theme")," code."),(0,i.kt)("p",null,"We can use the ",(0,i.kt)("inlineCode",{parentName:"p"},"bud")," cli to only run the compiler we need using ",(0,i.kt)("a",{parentName:"p",href:"/guides/bud-cli/build"},"the ",(0,i.kt)("inlineCode",{parentName:"a"},"--target")," flag"),"."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sh"},"$ yarn bud build --target theme\n")),(0,i.kt)("p",null,"If you had more than two instances it might make sense to want to target more than one compiler, and ",(0,i.kt)("inlineCode",{parentName:"p"},"--target")," supports that:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sh"},"$ yarn bud build --target theme --target plugin\n")),(0,i.kt)("h2",{id:"compilers-can-only-be-made-from-the-parent-context"},"Compilers can only be made from the parent context"),(0,i.kt)("p",null,"You cannot create a child compiler from a child compiler. So, don't do this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js",metastring:"title='bud.config.js' {9-13}",title:"'bud.config.js'","{9-13}":!0},"module.exports = app =>\n  app.make('theme', theme => {\n    theme\n      .use([require('@roots/bud-babel')])\n      .setPath('dist', 'dist/theme')\n      .entry('theme', ['theme.js', 'theme.css'])\n\n      .make('invalid', grandchild => {\n        /**\n         * `theme` cannot create a child compiler. only `app` can.\n         */\n      })\n  })\n")),(0,i.kt)("p",null,"If you want to create another child compiler, do so from the parent context:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js",metastring:"title='bud.config.js' {8-13}",title:"'bud.config.js'","{8-13}":!0},"module.exports = app =>\n  app\n    .make('theme', theme => {\n      theme\n        .use([require('@roots/bud-babel')])\n        .setPath('dist', 'dist/theme')\n        .entry('theme', ['theme.js', 'theme.css'])\n    })\n    .make('plugin', plugin => {\n      plugin\n        .use([require('@roots/bud-babel')])\n        .setPath('dist', 'dist/plugin')\n        .entry('plugin', ['plugin.js', 'plugin.css'])\n    })\n")))}h.isMDXComponent=!0},58215:function(e,t,n){var a=n(67294);t.Z=function(e){var t=e.children,n=e.hidden,r=e.className;return a.createElement("div",{role:"tabpanel",hidden:n,className:r},t)}},26396:function(e,t,n){n.d(t,{Z:function(){return m}});var a=n(87462),r=n(67294),i=n(72389),l=n(79443);var o=function(){var e=(0,r.useContext)(l.Z);if(null==e)throw new Error('"useUserPreferencesContext" is used outside of "Layout" component.');return e},u=n(63616),s=n(86010),c="tabItem_1uMI";function p(e){var t,n,i,l=e.lazy,p=e.block,m=e.defaultValue,d=e.values,h=e.groupId,g=e.className,f=r.Children.map(e.children,(function(e){if((0,r.isValidElement)(e)&&void 0!==e.props.value)return e;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})),b=null!=d?d:f.map((function(e){var t=e.props;return{value:t.value,label:t.label,attributes:t.attributes}})),k=(0,u.lx)(b,(function(e,t){return e.value===t.value}));if(k.length>0)throw new Error('Docusaurus error: Duplicate values "'+k.map((function(e){return e.value})).join(", ")+'" found in <Tabs>. Every value needs to be unique.');var v=null===m?m:null!=(t=null!=m?m:null==(n=f.find((function(e){return e.props.default})))?void 0:n.props.value)?t:null==(i=f[0])?void 0:i.props.value;if(null!==v&&!b.some((function(e){return e.value===v})))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+v+'" but none of its children has the corresponding value. Available values are: '+b.map((function(e){return e.value})).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");var y=o(),w=y.tabGroupChoices,N=y.setTabGroupChoices,x=(0,r.useState)(v),C=x[0],T=x[1],j=[],I=(0,u.o5)().blockElementScrollPositionUntilNextRender;if(null!=h){var E=w[h];null!=E&&E!==C&&b.some((function(e){return e.value===E}))&&T(E)}var Z=function(e){var t=e.currentTarget,n=j.indexOf(t),a=b[n].value;a!==C&&(I(t),T(a),null!=h&&N(h,a))},_=function(e){var t,n=null;switch(e.key){case"ArrowRight":var a=j.indexOf(e.currentTarget)+1;n=j[a]||j[0];break;case"ArrowLeft":var r=j.indexOf(e.currentTarget)-1;n=j[r]||j[j.length-1]}null==(t=n)||t.focus()};return r.createElement("div",{className:"tabs-container"},r.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,s.Z)("tabs",{"tabs--block":p},g)},b.map((function(e){var t=e.value,n=e.label,i=e.attributes;return r.createElement("li",(0,a.Z)({role:"tab",tabIndex:C===t?0:-1,"aria-selected":C===t,key:t,ref:function(e){return j.push(e)},onKeyDown:_,onFocus:Z,onClick:Z},i,{className:(0,s.Z)("tabs__item",c,null==i?void 0:i.className,{"tabs__item--active":C===t})}),null!=n?n:t)}))),l?(0,r.cloneElement)(f.filter((function(e){return e.props.value===C}))[0],{className:"margin-vert--md"}):r.createElement("div",{className:"margin-vert--md"},f.map((function(e,t){return(0,r.cloneElement)(e,{key:t,hidden:e.props.value!==C})}))))}function m(e){var t=(0,i.Z)();return r.createElement(p,(0,a.Z)({key:String(t)},e))}}}]);