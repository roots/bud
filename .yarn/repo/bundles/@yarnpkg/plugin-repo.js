/* eslint-disable */
//prettier-ignore
module.exports = {
name: "@yarnpkg/plugin-repo",
factory: function (require) {
var plugin=(()=>{var B=Object.create,h=Object.defineProperty;var O=Object.getOwnPropertyDescriptor;var P=Object.getOwnPropertyNames;var R=Object.getPrototypeOf,S=Object.prototype.hasOwnProperty;var A=e=>h(e,"__esModule",{value:!0});var r=e=>{if(typeof require!="undefined")return require(e);throw new Error('Dynamic require of "'+e+'" is not supported')};var C=(e,s)=>{for(var t in s)h(e,t,{get:s[t],enumerable:!0})},I=(e,s,t)=>{if(s&&typeof s=="object"||typeof s=="function")for(let i of P(s))!S.call(e,i)&&i!=="default"&&h(e,i,{get:()=>s[i],enumerable:!(t=O(s,i))||t.enumerable});return e},o=e=>I(A(h(e!=null?B(R(e)):{},"default",e&&e.__esModule&&"default"in e?{get:()=>e.default,enumerable:!0}:{value:e,enumerable:!0})),e);var K={};C(K,{default:()=>F});var w=o(r("@yarnpkg/cli")),x=o(r("@yarnpkg/core")),k=o(r("@yarnpkg/shell")),$;(function(t){t[t.ERROR=1]="ERROR",t[t.OK=0]="OK"})($||($={}));var a=class extends w.BaseCommand{async getManifest(){return await x.Manifest.tryFind(this.context.cwd)}async $(...s){await Promise.all(s.map(async t=>{if(!!t){process.stdout.write(`[repo] ${t}`);try{let i=await(0,k.execute)(t);if(i!==0)throw new Error(`[repo] ${t} failed with code ${i}`);process.stdout.write(`[repo] ${t} completed with code ${i}`)}catch(i){throw new Error(i)}}}))}};var n=o(r("clipanion")),l=class extends a{constructor(){super(...arguments);this.cjs=n.Option.Boolean("-c,--cjs",!1,{description:"build commonjs. default true."});this.esm=n.Option.Boolean("-e,--esm",!1,{description:"build esmodules. default true."});this.clean=n.Option.Boolean("--clean",!1,{description:"build with tsc --clean flag. default false"});this.force=n.Option.Boolean("--force",!1,{description:"build with tsc --force flag. default false."});this.verbose=n.Option.Boolean("--verbose",!0,{description:"build with tsc --verbose flag. default true."});this.watch=n.Option.Boolean("--watch",!1,{description:"build with tsc --watch flag. default false."})}async execute(){this.clean&&(this.verbose=!1),this.clean&&this.force&&console.error("--clean and --force are mutually exclusive");let s=!this.cjs&&!this.esm,t={cjs:`yarn tsc -b tsconfig.json${this.verbose?" --verbose":""}${this.clean?" --clean":""}${this.force?" --force":""}${this.watch?" --watch":""}`,esm:`yarn tsc -b tsconfig.esm.json${this.verbose?" --verbose":""}${this.clean?" --clean":""}${this.force?" --force":""}${this.watch?" --watch":""}`};this.all?await this.$(t.cjs,t.esm):this.cjs?await this.$(t.cjs):this.esm&&await this.$(t.esm),await this.$("yarn repo compile @roots/container","yarn repo compile @roots/filesystem","yarn repo compile @roots/bud-dashboard","yarn repo compile @roots/bud-support")}};l.paths=[["repo","build"]],l.usage={category:"repo",details:"build project packages.",examples:[["build packages as commonjs","yarn repo build --cjs"],["build packages as esm","yarn repo build --esm"],["build packages with tsc --clean flag","yarn repo build --clean"],["build packages with tsc --force flag","yarn repo build --force"],["build packages with tsc --verbose flag","yarn repo build --verbose"],["build packages with tsc --watch flag","yarn repo build --watch"],["force build commonjs verbosely","yarn repo build --cjs --verbose --force"]]};var j=o(r("clipanion")),c=class extends a{constructor(){super(...arguments);this.options={dfx:j.Option.Boolean("-d,--dfx",!1,{description:"use with caution. alias for git clean -dfx. removes all files not tracked in repo. default false."})}}async execute(){if(await this.$("yarn cache clean"),this.options.dfx){await this.$("git clean -dfx");return}this.options.dfx||(await this.$("yarn rimraf **/.budfiles"),await this.$("yarn rimraf **/node_modules"),await this.$("yarn rimraf packages/@roots/*/lib"),await this.$("yarn rimraf packages/@roots/*/types"))}};c.paths=[["repo","clean"]],c.usage={category:"repo",details:"clean project artifacts files",examples:[["delete all project artifacts","yarn repo clean"],["delete all untracked files","yarn repo clean --dfx"]]};var v=o(r("clipanion")),p=class extends a{constructor(){super(...arguments);this.package=v.Option.String()}async execute(){await this.$(`yarn ts-node ./dev/tasks/compile/cjs ${this.package}`),await this.$(`yarn ts-node ./dev/tasks/compile/esm ${this.package}`)}};p.paths=[["repo","compile"]],p.usage={category:"repo",description:"compile a package",details:"compiles as both cjs and esm with ncc",examples:[["compile {package name}","yarn repo compile @roots/bud-support"]]};var y=o(r("clipanion")),d=class extends a{constructor(){super(...arguments);this.prettier=y.Option.Boolean("-p,--prettier",!1,{description:"run prettier"});this.eslint=y.Option.Boolean("-e,--eslint",!1,{description:"run eslint"});this.skypack=y.Option.Boolean("-s,--skypack",!1,{description:"run skypack"})}async execute(){let s=!this.prettier&&!this.skypack&&!this.eslint;s&&(this.prettier=!0,this.skypack=!0,this.eslint=!0),s&&await this.$("yarn eslint packages/@roots/*/src/**/*.{js,jsx,ts,tsx} --fix","yarn eslint dev/**/*.{js,jsx,ts,tsx} --fix","yarn prettier packages/@roots/*/{src,types,lib}/**/*.{ts,js,tsx,jsx} --write --ignore-unknown --loglevel silent --no-error-on-unmatched-pattern","yarn prettier {dev,site}/**/*.{ts,js,tsx,jsx} --write --ignore-unknown --loglevel silent --no-error-on-unmatched-pattern","yarn workspaces foreach --no-private --exclude @roots/bud-typings -p -v run pkg"),await this.$(...this.eslint?["yarn eslint packages/@roots/*/src/**/*.{js,jsx,ts,tsx} --fix","yarn eslint dev/**/*.{js,jsx,ts,tsx} --fix"]:[],...this.prettier?["yarn prettier packages/@roots/*/{src,types,lib}/**/*.{ts,js,tsx,jsx} --write --ignore-unknown --loglevel silent --no-error-on-unmatched-pattern","yarn prettier {dev,site}/**/*.{ts,js,tsx,jsx} --write --ignore-unknown --loglevel silent --no-error-on-unmatched-pattern"]:[],this.skypack?"yarn workspaces foreach --no-private --exclude @roots/bud-typings -p -v run pkg":null)}};d.paths=[["repo","lint"]],d.usage={category:"repo",description:"lint repo files. run all linters by passing no flags.",examples:[["run all linters","yarn repo lint"],["run prettier","yarn repo lint --prettier"],["run eslint","yarn repo lint --eslint"],["run skypack","yarn repo lint --skypack"]]};var g=o(r("clipanion")),u=class extends a{constructor(){super(...arguments);this.workers=g.Option.String("-w,--workers","50%",{description:"number of workers. default 50%."});this.update=g.Option.Boolean("--update",!1,{description:"update snapshots. default false."})}async execute(){await this.$(`yarn jest --verbose --maxWorkers=${this.workers} ${this.update?"--updateSnapshot":"--coverage"}`)}};u.paths=[["repo","test"]],u.usage={category:"repo",details:"test files with jest",examples:[["test","yarn repo test"],["update snapshots","yarn repo test --update"]]};var m=class extends a{async execute(){await this.$("yarn install --immutable"),await this.$("yarn repo build"),await this.$("yarn repo lint"),await this.$("yarn repo test")}};m.paths=[["repo","make"]],m.usage={category:"repo",description:"make project files same as ci",examples:[["yarn repo make"]]};var b=o(r("clipanion")),f=class extends a{constructor(){super(...arguments);this.api=b.Option.Boolean("-a,--api",!1,"build api docs");this.site=b.Option.Boolean("-s,--site",!1,"build site files");this.readme=b.Option.Boolean("-r,--readme",!1,"build readme files")}async execute(){!this.site&&!this.readme&&!this.docs&&(await this.$("yarn node ./site/api-documenter.build.js"),await this.$("yarn workspace @roots/bud-docs run docusaurus build","yarn ts-node-transpile-only ./dev/readme")),(this.docs||this.site)&&await this.$("yarn node ./site/api-documenter.build.js"),await this.$(this.site?"yarn workspace @roots/bud-docs run docusaurus build":null,this.readme?"yarn ts-node-transpile-only ./dev/readme":null)}};f.paths=[["repo","docs"]],f.usage={category:"repo",description:"build docs and readme files. no flags builds everything. running with the --site flag will also build api docs.",examples:[["build all","yarn repo docs"],["build api documentation","yarn repo docs --api"],["build api documentation and site files","yarn repo docs --site"],["build readme files","yarn docs --readme"]]};var W={hooks:{afterAllInstalled:()=>{console.log("What a great install, am I right?")}},commands:[l,c,p,d,m,f,u]},F=W;return K;})();
return plugin;
}
};
